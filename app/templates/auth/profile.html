{% extends 'layout.html' %}
{% block title %}Profile - Green Shelf{% endblock %}

{% block content %}
<!-- Profile Header Section -->
<div class="profile-header mb-4">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="profile-info">
                    <div class="profile-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="profile-details">
                        <h2 class="profile-name">{{ current_user.username }}</h2>
                        <p class="profile-subtitle">{{ current_user.email }}</p>
                        <div class="profile-badges">
                            <span class="badge bg-success">
                                <i class="fas fa-calendar me-1"></i>
                                Member since {{ current_user.created_at.strftime('%Y') }}
                            </span>
                            <span class="badge bg-info">
                                <i class="fas fa-map-marker-alt me-1"></i>
                                {{ current_user.pincode }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ current_user.created_at | days_since }}</div>
                        <div class="stat-label">Days Active</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <!-- Personal Information Section -->
        <div class="modern-card profile-card mb-4">
            <div class="modern-card-header">
                <div class="card-header-content">
                    <div class="card-icon">
                        <i class="fas fa-user-edit"></i>
                    </div>
                    <div class="card-title-section">
                        <h5 class="card-title">Personal Information</h5>
                        <p class="card-subtitle">Update your basic profile details</p>
                    </div>
                </div>
            </div>
            <div class="modern-card-body">
                <form method="POST" class="profile-form" id="profileForm">
                    {{ form.hidden_tag() }}
                    
                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="form-group-modern">
                                    <div class="input-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    {{ form.family_size.label(class="form-label-modern") }}
                                    {{ form.family_size(class="form-control-modern" + (" is-invalid" if form.family_size.errors else "")) }}
                                    {% if form.family_size.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.family_size.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="form-text">Number of people in your household</small>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <div class="form-group-modern">
                                    <div class="input-icon">
                                        <i class="fas fa-credit-card"></i>
                                    </div>
                                    {{ form.upi_id.label(class="form-label-modern") }}
                                    {{ form.upi_id(class="form-control-modern" + (" is-invalid" if form.upi_id.errors else "")) }}
                                    {% if form.upi_id.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.upi_id.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="form-text">For automatic payments</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Preferences Section -->
        <div class="modern-card profile-card mb-4">
            <div class="modern-card-header">
                <div class="card-header-content">
                    <div class="card-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="card-title-section">
                        <h5 class="card-title">Food Preferences</h5>
                        <p class="card-subtitle">Tell us about your preferences for better recommendations</p>
                    </div>
                </div>
            </div>
            <div class="modern-card-body">
                <div class="form-section" form="profileForm">
                    <div class="mb-4">
                        <div class="form-group-modern">
                            <div class="input-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            {{ form.preferred_brands.label(class="form-label-modern") }}
                            {{ form.preferred_brands(class="form-control-modern textarea-modern", form="profileForm", rows=3, placeholder="Enter one brand per line, e.g.:\nAmul\nGokul\nMother Dairy") }}
                            {% if form.preferred_brands.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.preferred_brands.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <small class="form-text">Your favorite brands for better product suggestions</small>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="form-group-modern">
                            <div class="input-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            {{ form.dietary_restrictions.label(class="form-label-modern") }}
                            {{ form.dietary_restrictions(class="form-control-modern textarea-modern", form="profileForm", rows=3, placeholder="Enter one restriction per line, e.g.:\nLactose intolerant\nDiabetic\nVegetarian") }}
                            {% if form.dietary_restrictions.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.dietary_restrictions.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <small class="form-text">We'll help you avoid items that don't match your diet</small>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="form-group-modern">
                            <div class="input-icon">
                                <i class="fas fa-pepper-hot"></i>
                            </div>
                            {{ form.taste_preferences.label(class="form-label-modern") }}
                            {{ form.taste_preferences(class="form-control-modern textarea-modern", form="profileForm", rows=3, placeholder="Enter one preference per line, e.g.:\nSpicy\nSweet\nSalty") }}
                            {% if form.taste_preferences.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.taste_preferences.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <small class="form-text">Your taste preferences for recipe recommendations</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delivery & Settings Section -->
        <div class="modern-card profile-card mb-4">
            <div class="modern-card-header">
                <div class="card-header-content">
                    <div class="card-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="card-title-section">
                        <h5 class="card-title">Delivery & Auto-Order Settings</h5>
                        <p class="card-subtitle">Configure when and how you want to receive orders</p>
                    </div>
                </div>
            </div>
            <div class="modern-card-body">
                <div class="form-section" form="profileForm">
                    <div class="mb-4">
                        <div class="form-group-modern">
                            <div class="input-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            {{ form.delivery_time_slots.label(class="form-label-modern") }}
                            {{ form.delivery_time_slots(class="form-control-modern textarea-modern", form="profileForm", rows=3, placeholder="Enter available time slots, e.g.:\n9:00 AM - 12:00 PM\n6:00 PM - 9:00 PM") }}
                            {% if form.delivery_time_slots.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.delivery_time_slots.errors %}{{ error }}{% endfor %} 
                                </div>
                            {% endif %}
                            <small class="form-text">When you're available to receive deliveries</small>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="form-group-modern">
                                <div class="input-icon">
                                    <i class="fas fa-stopwatch"></i>
                                </div>
                                {{ form.check_interval_minutes.label(class="form-label-modern") }}
                                {{ form.check_interval_minutes(class="form-control-modern", form="profileForm") }}
                                {% if form.check_interval_minutes.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.check_interval_minutes.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <small class="form-text">How often to check inventory (in minutes)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-toggles">
                        <div class="toggle-item">
                            <div class="toggle-content">
                                <div class="toggle-info">
                                    <h6 class="toggle-title">
                                        <i class="fas fa-robot me-2"></i>
                                        {{ form.auto_order_enabled.label.text }}
                                    </h6>
                                    <p class="toggle-description">Automatically place orders when items run low</p>
                                </div>
                                <div class="toggle-switch">
                                    {{ form.auto_order_enabled(class="form-check-input modern-toggle", form="profileForm") }}
                                    <label for="{{ form.auto_order_enabled.id }}" class="toggle-label"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="toggle-item">
                            <div class="toggle-content">
                                <div class="toggle-info">
                                    <h6 class="toggle-title">
                                        <i class="fas fa-shopping-cart me-2"></i>
                                        {{ form.checkout_enabled.label.text }}
                                    </h6>
                                    <p class="toggle-description">Complete checkout process automatically</p>
                                </div>
                                <div class="toggle-switch">
                                    {{ form.checkout_enabled(class="form-check-input modern-toggle", form="profileForm") }}
                                    <label for="{{ form.checkout_enabled.id }}" class="toggle-label"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        {{ form.submit(class="btn btn-primary btn-lg save-profile-btn", form="profileForm") }}
                        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="resetForm()">
                            <i class="fas fa-undo me-2"></i>Reset Changes
                        </button>
                    </div>
                </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Account Overview -->
        <div class="modern-card sidebar-card mb-4">
            <div class="modern-card-header">
                <div class="card-header-content">
                    <div class="card-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="card-title-section">
                        <h6 class="card-title">Account Overview</h6>
                    </div>
                </div>
            </div>
            <div class="modern-card-body">
                <div class="account-info">
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Email</span>
                            <span class="info-value">{{ current_user.email }}</span>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Member Since</span>
                            <span class="info-value">{{ current_user.created_at | format_date }}</span>
                            <small class="text-muted d-block">{{ current_user.created_at | time_ago }}</small>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Location</span>
                            <span class="info-value">{{ current_user.pincode }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="modern-card sidebar-card mb-4">
            <div class="modern-card-header">
                <div class="card-header-content">
                    <div class="card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="card-title-section">
                        <h6 class="card-title">Your Activity</h6>
                    </div>
                </div>
            </div>
            <div class="modern-card-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">0</div>
                            <div class="stat-label">Orders</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">0</div>
                            <div class="stat-label">Items</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">0</div>
                            <div class="stat-label">Recipes</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number">â‚¹0</div>
                            <div class="stat-label">Saved</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="modern-card sidebar-card">
            <div class="modern-card-header">
                <div class="card-header-content">
                    <div class="card-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="card-title-section">
                        <h6 class="card-title">Quick Actions</h6>
                    </div>
                </div>
            </div>
            <div class="modern-card-body">
                <div class="action-buttons">
                    <a href="{{ url_for('auth.onboarding') }}" class="action-btn">
                        <div class="action-icon">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="action-content">
                            <span class="action-title">Setup Guide</span>
                            <span class="action-description">Complete your profile setup</span>
                        </div>
                    </a>
                    
                    <a href="{{ url_for('main.index') }}" class="action-btn">
                        <div class="action-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="action-content">
                            <span class="action-title">Dashboard</span>
                            <span class="action-description">Go to your main dashboard</span>
                        </div>
                    </a>
                    
                    <a href="#" class="action-btn">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-content">
                            <span class="action-title">Export Data</span>
                            <span class="action-description">Download your profile data</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth scrolling to form sections
    const formSections = document.querySelectorAll('.modern-card');
    
    // Add save confirmation
    const saveBtn = document.querySelector('.save-profile-btn');
    if (saveBtn) {
        saveBtn.addEventListener('click', function(e) {
            // Add loading state
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
            this.disabled = true;
        });
    }
    
    // Add interactive feedback for form inputs
    const inputs = document.querySelectorAll('.form-control-modern');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
        });
        
        input.addEventListener('blur', function() {
            this.parentElement.classList.remove('focused');
        });
    });
    
    // Toggle switch animation
    const toggles = document.querySelectorAll('.modern-toggle');
    toggles.forEach(toggle => {
        toggle.addEventListener('change', function() {
            const toggleItem = this.closest('.toggle-item');
            if (this.checked) {
                toggleItem.style.background = '#e3f2fd';
                toggleItem.style.borderColor = '#667eea';
            } else {
                toggleItem.style.background = '#f8f9fa';
                toggleItem.style.borderColor = '#e9ecef';
            }
        });
    });
});

// Reset form function
function resetForm() {
    if (confirm('Are you sure you want to reset all changes? This will reload the page.')) {
        window.location.reload();
    }
}

// Add visual feedback for action buttons
document.querySelectorAll('.action-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
        const icon = this.querySelector('.action-icon');
        icon.style.transform = 'scale(0.95)';
        setTimeout(() => {
            icon.style.transform = 'scale(1)';
        }, 150);
    });
});
</script>

{% endblock %}


